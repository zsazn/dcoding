upstream app_server{
	server unix:/opt/myenv/run/gunicorn.sock fail_timeout=0;
}

server {
	server_name dc.zsazn.com;
	listen 80;
	listen [::]:80 default_server ipv6only=on ;
	return 301 https://$server_name$request_uri;
}

server {
	add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
	listen 443 ssl;
	listen [::]:43 ssl ipv6only=on;

	server_name dc.zsazn.com;

#	ssl                       on;
#        ssl_certificate           /etc/letsencrypt/live/dc.zsazn.com/fullchain.pem; # managed by Certbot
 #       ssl_certificate_key       /etc/letsencrypt/live/dc.zsazn.com/privkey.pem; # managed by Certbot
#	include                   /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot 
#	ssl_dhparam		  /etc/letsencrypt/ssl-dhparams.pem; #managed by Certbot

	keepalive_timeout 5;

	access_log /var/log/nginx/dcoding/access.log;
	error_log /var/log/nginx/dcoding/error.log;

	location /static/ {
		alias /opt/myenv/projects/dcoding/staticfiles/;
	}

	location / {
		proxy_pass	                          http://app_server;
		proxy_redirect	                          off;
		proxy_set_header Host                     $host:443;
		proxy_set_header X-Forwarded-Proto        https;
		proxy_set_header X-Forwarded-For          $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Host         $host:443;
		proxy_set_header X-Forwarded-Server       $host;
		proxy_set_header X-Real-IP                $remote_addr;
		proxy_read_timeout 300s;
		add_header P3P 'CP="ALL DSP COR PSAa PSDa OUR NOR ONL UNI COM NAV"';
	}

}
